@model PageSeedViewModel
@{
    ViewData["Title"] = "Portal RH • Liotécnica";
    ViewData["SidebarSubtitle"] = "Recrutamento & Match";
}



      @section Topbar {
@await Html.PartialAsync("_TopbarBrand", "Vagas, Curr?culos e Matching autom?tico")

          <div class="searchbox position-relative d-none d-md-block">
            <i class="bi bi-search"></i>
            <input id="globalSearch" class="form-control" placeholder="Buscar vaga, candidato, palavra-chave..." />
          </div>

          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-ghost" type="button" data-bs-toggle="offcanvas" data-bs-target="#drawerFilters">
              <i class="bi bi-sliders"></i>
              <span class="d-none d-sm-inline ms-1">Filtros</span>
            </button>

            <button class="btn btn-brand" type="button" data-bs-toggle="offcanvas" data-bs-target="#drawerQuick">
              <i class="bi bi-plus-lg"></i>
              <span class="d-none d-sm-inline ms-1">Ações</span>
            </button>

                        @await Html.PartialAsync("_TopbarUserMenu", "RH")
          </div>
}

      <!-- CONTENT -->
      <section class="content">
        <div class="page-title">
          <div>
            <h4 id="pageH4">Dashboard</h4>
            <div class="subtitle" id="pageSub">Visão geral do dia: vagas, recebimentos e triagem.</div>
          </div>

          <div class="d-flex align-items-center gap-2">
            <span class="badge-soft"><i class="bi bi-clock me-1"></i><span id="nowLabel">—</span></span>
            <span class="badge-soft"><i class="bi bi-lightning-charge me-1"></i>Match automático</span>
          </div>
        </div>

        <!-- KPIs -->
                @{
          var kpis = new[]
          {
            new { ColClass = "col-12 col-md-6 col-xl-3", Label = "Vagas abertas", ValueId = "kpiVagas", Value = "0", Hint = "+2 na ultima semana", Icon = "bi-briefcase", ModalTarget = "#modalVagasAbertas" },
            new { ColClass = "col-12 col-md-6 col-xl-3", Label = "CVs recebidos hoje", ValueId = "kpiCvsHoje", Value = "37", Hint = "Entrada email/pasta", Icon = "bi-inbox", ModalTarget = "" },
            new { ColClass = "col-12 col-md-6 col-xl-3", Label = "Pendentes de match", ValueId = "kpiPendentes", Value = "9", Hint = "Fila de processamento", Icon = "bi-hourglass-split", ModalTarget = "" },
            new { ColClass = "col-12 col-md-6 col-xl-3", Label = "Aprovados (7 dias)", ValueId = "kpiAprovados", Value = "18", Hint = "+6 vs semana anterior", Icon = "bi-patch-check", ModalTarget = "" }
          };
        }
        @await Html.PartialAsync("_KpiCardRow", kpis)

        <!-- CHART + FUNIL -->
        <div class="row g-3 mt-1">
          <div class="col-12 col-xl-7">
            <div class="card-soft p-3">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <div>
                  <div class="fw-bold">Recebimento de currículos</div>
                  <div class="text-muted small">Últimos 14 dias (mock)</div>
                </div>
                <span class="badge-soft"><i class="bi bi-graph-up me-1"></i>tendência</span>
              </div>
              <canvas id="chartRecebidos" height="110"></canvas>
            </div>
          </div>

          <div class="col-12 col-xl-5">
            <div class="card-soft p-3 h-100">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <div>
                  <div class="fw-bold">Funil de triagem</div>
                  <div class="text-muted small">Visão consolidada (mock)</div>
                </div>
                <button class="btn btn-ghost btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#drawerFilters">
                  <i class="bi bi-funnel"></i>
                </button>
              </div>

              <div class="d-flex flex-column gap-3 mt-2">
                <div>
                  <div class="d-flex justify-content-between small">
                    <span class="text-muted">Recebidos</span><span class="fw-semibold">220</span>
                  </div>
                  <div class="progress"><div class="progress-bar" style="width: 100%"></div></div>
                </div>

                <div>
                  <div class="d-flex justify-content-between small">
                    <span class="text-muted">Triagem</span><span class="fw-semibold">140</span>
                  </div>
                  <div class="progress"><div class="progress-bar" style="width: 64%"></div></div>
                </div>

                <div>
                  <div class="d-flex justify-content-between small">
                    <span class="text-muted">Entrevista</span><span class="fw-semibold">58</span>
                  </div>
                  <div class="progress"><div class="progress-bar" style="width: 26%"></div></div>
                </div>

                <div>
                  <div class="d-flex justify-content-between small">
                    <span class="text-muted">Aprovados</span><span class="fw-semibold">18</span>
                  </div>
                  <div class="progress"><div class="progress-bar" style="width: 8%"></div></div>
                </div>
              </div>

              <div class="mt-3 small text-muted">
                Dica: use “Filtros” para segmentar por vaga, área e período.
              </div>
            </div>
          </div>
        </div>

        <!-- TABELA: MELHORES MATCHES -->
        <div class="card-soft p-3 mt-3">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
            <div>
              <div class="fw-bold">Top matches por vaga</div>
              <div class="text-muted small">Candidatos com maior aderência (mock)</div>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-ghost btn-sm" type="button"><i class="bi bi-download me-1"></i>Exportar</button>
              <button class="btn btn-brand btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#drawerQuick">
                <i class="bi bi-plus-lg me-1"></i>Nova vaga
              </button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th style="min-width: 220px;">Vaga</th>
                  <th style="min-width: 200px;">Candidato</th>
                  <th style="min-width: 170px;">Origem</th>
                  <th style="min-width: 240px;">Match</th>
                  <th style="min-width: 170px;">Etapa</th>
                  <th class="text-end" style="min-width: 150px;">Ações</th>
                </tr>
              </thead>
              <tbody id="tblBody">
                <!-- preenchido por JS -->
              </tbody>
            </table>
          </div>
        </div>

        <div style="height: 14px;"></div>
      </section>

  <div class="modal fade" id="modalVagasAbertas" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content" style="border-radius: 18px; border: 1px solid var(--lt-border);">
        <div class="modal-header">
          <div class="d-flex align-items-center gap-2">
            <div>
              <h5 class="modal-title fw-bold">Vagas abertas</h5>
              <div class="text-muted small">Lista de vagas com status aberto.</div>
            </div>
            <span class="badge-soft" id="openVagaCount">0</span>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th style="min-width: 120px;">Codigo</th>
                  <th style="min-width: 240px;">Vaga</th>
                  <th style="min-width: 160px;">Area</th>
                  <th style="min-width: 150px;">Modalidade</th>
                  <th style="min-width: 160px;">Local</th>
                  <th class="text-end" style="min-width: 140px;">Atualizado</th>
                  <th class="text-end" style="min-width: 120px;">Acoes</th>
                </tr>
              </thead>
              <tbody id="tblVagasAbertas"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <template id="tpl-vaga-aberta-row">
    <tr>
      <td class="mono" data-role="vaga-code"></td>
      <td>
        <div class="fw-semibold" data-role="vaga-title"></div>
        <div class="text-muted small" data-role="vaga-desc"></div>
      </td>
      <td data-role="vaga-area"></td>
      <td data-role="vaga-modalidade"></td>
      <td data-role="vaga-local"></td>
      <td class="text-end mono" data-role="vaga-updated"></td>
      <td class="text-end">
        <button class="btn btn-ghost btn-sm" type="button" data-act="open-vaga">
          <i class="bi bi-box-arrow-up-right me-1"></i>Ver vaga
        </button>
      </td>
    </tr>
  </template>

  <template id="tpl-vaga-aberta-empty-row">
    <tr>
      <td colspan="7" class="text-center text-muted py-3">Nenhuma vaga aberta.</td>
    </tr>
  </template>

            @section Footer {
        @{
          var footerItems = new[]
          {
            new { Icon = "bi-database", Text = "Postgres" },
            new { Icon = "bi-file-earmark-text", Text = "PDF/DOCX" },
            new { Icon = "bi-shield-lock", Text = "Seguran?a & LGPD" }
          };
        }
        @await Html.PartialAsync("_Footer", footerItems)
      }

    

  <!-- RIGHT DRAWER: FILTERS -->
  @await Html.PartialAsync("_OffcanvasFilters")

  <!-- RIGHT DRAWER: QUICK ACTIONS -->
  @await Html.PartialAsync("_OffcanvasQuick")

  <!-- Bootstrap JS -->

@section Scripts {
  <script>
    window.__seedData = @Html.Raw(Model.SeedJson);
  </script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="~/js/views/dashboard.js" asp-append-version="true"></script>
}
