@model PageSeedViewModel
@{
	ViewData["Title"] = "Portal RH - Liotecnica - Departamentos";
	ViewData["SidebarSubtitle"] = "Departamentos";
}

@await Html.PartialAsync("_ModalDepartamento")
@await Html.PartialAsync("_ModalDepartamentoVagas")
@await Html.PartialAsync("_Toast")

@section Topbar {
	@await Html.PartialAsync("_TopbarBrand", "Tela: Departamentos")

	<div class="searchbox position-relative d-none d-md-block">
		<i class="bi bi-search"></i>
		<input id="globalSearchDept" class="form-control" placeholder="Buscar departamento..." />
	</div>

	<div class="d-flex align-items-center gap-2">
		<button class="btn btn-ghost" type="button" id="btnExportDept" title="Exportar departamentos (CSV)">
			<i class="bi bi-filetype-csv"></i><span class="d-none d-sm-inline ms-1">Exportar</span>
		</button>
		<button class="btn btn-ghost" type="button" id="btnSeedReset" title="Restaurar demo">
			<i class="bi bi-arrow-counterclockwise"></i><span class="d-none d-sm-inline ms-1">Reset demo</span>
		</button>
		<button class="btn btn-brand" type="button" id="btnNewDept">
			<i class="bi bi-plus-lg"></i><span class="d-none d-sm-inline ms-1">Novo departamento</span>
		</button>
		@await Html.PartialAsync("_TopbarUserMenu", "RH")
	</div>
}

<section class="content">
	<div class="page-title">
		<div>
			<h4>Departamentos</h4>
			<div class="subtitle">Cadastro de areas, gestores e metas de headcount.</div>
		</div>
	</div>

	@{
		var kpis = new[]
		{
	new { ColClass = "col-6 col-lg-3", Title = "Departamentos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiDeptTotal", Value = "0", PillIcon = "bi-diagram-2", PillText = "total", Hint = "Departamentos cadastrados." },
	new { ColClass = "col-6 col-lg-3", Title = "Ativos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiDeptActive", Value = "0", PillIcon = "bi-check2-circle", PillText = "ativo", Hint = "Departamentos em operacao." },
	new { ColClass = "col-6 col-lg-3", Title = "Vagas abertas", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiDeptOpenRoles", Value = "0", PillIcon = "bi-briefcase", PillText = "abertas", Hint = "Total de vagas abertas." },
	new { ColClass = "col-6 col-lg-3", Title = "Headcount", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiDeptHeadcount", Value = "0", PillIcon = "bi-people", PillText = "pessoas", Hint = "Soma do headcount informado." }
	};
	}
	@await Html.PartialAsync("_KpiMiniRow", kpis)

	<div class="card-soft p-3 mb-3">
		<div class="d-flex flex-wrap align-items-end justify-content-between gap-2">
			<div>
				<div class="fw-bold">Lista de departamentos</div>
				<div class="text-muted small">Clique em um departamento para ver vagas relacionadas.</div>
			</div>
			<div class="d-flex flex-wrap gap-2 justify-content-end">
				<div style="min-width:240px;">
					<label class="form-label small mb-1">Buscar</label>
					<div class="input-group">
						<span class="input-group-text" style="background:rgba(255,255,255,.65)"><i class="bi bi-search"></i></span>
						<input class="form-control" id="dSearch" placeholder="nome, codigo, gestor...">
					</div>
				</div>
				<div>
					<label class="form-label small mb-1">Status</label>
					<select class="form-select" id="dStatus">
						<option value="all">Todos</option>
						<option value="ativo">Ativo</option>
						<option value="inativo">Inativo</option>
					</select>
				</div>
			</div>
		</div>

		<hr class="my-3 divider">

				<lt-grid table-class="table table-sm align-middle mb-0" body-id="deptTbody">
			<lt-grid-header>
				<tr>
					<th colspan="2">Departamento</th>
					<th>Gestor</th>
					<th class="text-center">Centro de custo</th>
					<th class="text-center">Filial</th>
					<th class="text-center">Headcount</th>
					<th class="text-center">Vagas</th>
					<th class="text-center">Status</th>
					<th class="text-center">Acoes</th>
				</tr>
			</lt-grid-header>
		</lt-grid>

		<div class="d-flex align-items-center justify-content-between mt-2">
			<div class="text-muted small" id="deptHint">-</div>
			<div class="d-flex align-items-center gap-2">
				<span class="pill"><i class="bi bi-table"></i><span id="deptCount">0</span> exibidos</span>
			</div>
		</div>
	</div>

	<template id="tpl-dept-row">
		<tr>
			<td class="td-initials text-center">
				<span class="initials-badge" data-role="dept-initials"></span>
			</td>
			<td>
				<div class="fw-semibold" data-role="dept-name"></div>
				<div class="text-muted small" data-role="dept-code"></div>
			</td>
			<td>
				<div class="fw-semibold" data-role="dept-gestor"></div>
			</td>
			<td class="text-center" data-role="dept-cost"></td>
			<td class="text-center" data-role="dept-local"></td>
			<td class="mono text-center" data-role="dept-headcount"></td>
			<td class="mono text-center" data-role="dept-vagas"></td>
			<td class="text-center"><span data-role="dept-status-host"></span></td>
			<td class="text-end" style="min-width:120px;"> 
				<button class="btn btn-ghost btn-sm me-1" type="button" data-act="detail">
					<i class="bi bi-eye"></i>
				</button>
				<button class="btn btn-ghost btn-sm me-1" type="button" data-act="edit">
					<i class="bi bi-pencil"></i>
				</button>
				<button class="btn btn-ghost btn-sm text-danger" type="button" data-act="del">
					<i class="bi bi-trash3"></i>
				</button>
			</td>
		</tr>
	</template>

	<template id="tpl-dept-empty-row">
		<tr>
			<td colspan="8" class="text-center text-muted py-3">Nenhum departamento encontrado.</td>
		</tr>
	</template>

	<div style="height:14px;"></div>
</section>

@section Footer {
	@{
		var footerItems = new[]
		{
	  new { Icon = "bi-diagram-2", Text = "Departamentos", Id = "", Class = "" },
	  new { Icon = "bi-shield-check", Text = "LGPD", Id = "", Class = "" },
	  new { Icon = "", Text = "build: demo", Id = "buildId", Class = "mono muted" }
	};
	}
	@await Html.PartialAsync("_Footer", footerItems)
}

@section Scripts {
	<script>
		window.__seedData = @Html.Raw(Model.SeedJson);
	</script>
	<script src="~/js/views/departamentos.js" asp-append-version="true"></script>
}
