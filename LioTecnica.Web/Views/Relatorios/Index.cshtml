@model PageSeedViewModel
@{
	ViewData["Title"] = "Portal RH ï Devcraft Studio ï RelatÛrios";
	ViewData["SidebarSubtitle"] = "RelatÛrios";
}



<!-- MOBILE SIDEBAR OFFCANVAS -->
@section Topbar {
	@await Html.PartialAsync("_TopbarBrand", "Tela: RelatÛrios")

	<div class="d-flex align-items-center gap-2">
		<button class="btn btn-ghost" type="button" id="btnSeedReset" title="Restaurar demo">
			<i class="bi bi-arrow-counterclockwise"></i><span class="d-none d-sm-inline ms-1">Reset demo</span>
		</button>

		<button class="btn btn-ghost" type="button" id="btnExport" title="Exportar relatÛrio atual (CSV)">
			<i class="bi bi-filetype-csv"></i><span class="d-none d-sm-inline ms-1">Exportar CSV</span>
		</button>

		<button class="btn btn-brand" type="button" id="btnRun">
			<i class="bi bi-play-circle"></i><span class="d-none d-sm-inline ms-1">Gerar</span>
		</button>

		@await Html.PartialAsync("_TopbarUserMenu", "RH")
	</div>
}

<!-- CONTENT -->
<section class="content">
	<div class="page-title">
		<div>
			<h4>RelatÛrios</h4>
			<div class="subtitle">Gere relatÛrios operacionais e gerenciais. No sistema real: filtros & query Postgres & exportaÁ„o.</div>
		</div>
	</div>

	<!-- KPI row -->
	@{
		var kpis = new[]
		{
	new { ColClass = "col-6 col-lg-3", Title = "Vagas", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiVagas", Value = "0", PillIcon = "bi-briefcase", PillText = "ativas", Hint = "Total no cadastro (demo)." },
	new { ColClass = "col-6 col-lg-3", Title = "Candidatos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiCands", Value = "0", PillIcon = "bi-people", PillText = "base", Hint = "Recebidos/triados (demo)." },
	new { ColClass = "col-6 col-lg-3", Title = "Entrada", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiInbox", Value = "0", PillIcon = "bi-inbox", PillText = "itens", Hint = "Fila (novo/processando)." },
	new { ColClass = "col-6 col-lg-3", Title = "Convers„o", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiConv", Value = "0%", PillIcon = "bi-arrow-right-circle", PillText = "triagem", Hint = "Processado ‚Üí candidato." }
	};
	}
	@await Html.PartialAsync("_KpiMiniRow", kpis)

	<div class="grid2">
		<!-- LEFT: cat·logo de relatÛrios + filtros -->
		<div>
			<div class="card-soft p-3 mb-3">
				<div class="d-flex align-items-start justify-content-between gap-2">
					<div>
						<div class="fw-bold">Cat·logo de relatÛrios</div>
						<div class="text-muted small">Selecione um relatÛrio e configure filtros.</div>
					</div>
				</div>

				<hr class="my-3 divider">

				<lt-list class="d-grid gap-2" id="reportList"></lt-list>
			</div>

			<div class="card-soft p-3">
				<div class="fw-bold">Filtros</div>
				<div class="text-muted small">Os filtros alteram a tabela/gr·ficoù do relatÛrio selecionado.</div>

				<div class="row g-2 mt-2">
					<div class="col-12">
						<label class="form-label small">PerÌ≠odo</label>
						<select class="form-select" id="fPeriod" data-enum="relatorioPeriodo" data-selected="30d" style="min-width: 200px; border-color:var(--lt-border);"></select>
					</div>

					<div class="col-12">
						<label class="form-label small">Vaga</label>
						<select class="form-select" id="fVaga" style="min-width: 240px; border-color:var(--lt-border);"></select>
					</div>

					<div class="col-12">
						<label class="form-label small">Origem</label>
						<select class="form-select" id="fOrigem" data-enum="origemFilterSimple" style="min-width: 180px; border-color:var(--lt-border);"></select>
					</div>

					<div class="col-12">
						<label class="form-label small">Status</label>
						<select class="form-select" id="fStatus" data-enum="inboxStatusFilterSimple" style="min-width: 180px; border-color:var(--lt-border);"></select>
					</div>

					<div class="col-12">
						<label class="form-label small">Buscar</label>
						<div class="input-group">
							<span class="input-group-text" style="background:rgba(255,255,255,.65)"><i class="bi bi-search"></i></span>
							<input class="form-control" id="fSearch" placeholder="Nome, email, assunto, arquivo...">
						</div>
					</div>
				</div>

				<div class="d-flex flex-wrap gap-2 mt-3">
					<button class="btn btn-brand btn-sm" id="btnApply"><i class="bi bi-filter-circle me-1"></i>Aplicar</button>
					<button class="btn btn-ghost btn-sm" id="btnClear"><i class="bi bi-x-circle me-1"></i>Limpar</button>
				</div>

				<div class="text-muted small mt-3">
					<i class="bi bi-info-circle me-1"></i>
					No produto real: filtros viram par√¢metros de query e agregaÁıes no Postgres.
				</div>
			</div>
		</div>

		<!-- RIGHT: relatÛrio selecionado -->
		<div>
			<div class="card-soft p-3 mb-3">
				<div class="d-flex flex-wrap align-items-start justify-content-between gap-2">
					<div>
						<div class="fw-bold" id="reportTitle">ï</div>
						<div class="text-muted small" id="reportDesc">Selecione um relatÛrio no cat·logo.</div>
					</div>
					<div class="d-flex flex-wrap gap-2 justify-content-end">
						<span class="tag" id="tagScope"><i class="bi bi-sliders"></i>escopo</span>
						<span class="tag ok" id="tagFresh"><i class="bi bi-clock-history"></i>atual</span>
					</div>
				</div>

				<hr class="my-3 divider">

				<div class="chart-wrap mb-3">
					<!-- gr√°fico simples em canvas (mocado) -->
					<canvas id="chart" style="width:100%; height:100%;"></canvas>
				</div>

				<div class="d-flex align-items-center justify-content-between gap-2 flex-wrap">
					<div class="mini-title">Resultados</div>
					<div class="d-flex gap-2 flex-wrap">
						<span class="pill"><i class="bi bi-table"></i><span id="rowCount">0</span> linhas</span>
						<span class="pill"><i class="bi bi-filetype-csv"></i>export·vel</span>
					</div>
				</div>

				<lt-grid wrapper-class="table-responsive mt-2" table-class="table table-sm align-middle mb-0" table-id="resultTable" body-id="tbodyRows">
					<lt-grid-header>
						<tr id="theadRow"></tr>
					</lt-grid-header>
				</lt-grid>

				<div class="text-muted small mt-3" id="resultHint"></div>
			</div>

			<div class="card-soft p-3">
				<div class="fw-bold">Agendamento</div>
				<div class="text-muted small">Exemplo visual de como seria agendar envio autom·tico por e-mail.</div>

				<div class="row g-2 mt-2">
					<div class="col-12 col-md-6">
						<label class="form-label small">Destinat·rios</label>
						<input class="form-control" placeholder="ex.: rh@@empresa.com; gestor@@empresa.com">
					</div>
					<div class="col-6 col-md-3">
						<label class="form-label small">FrequÍncia</label>
						<select class="form-select" id="fFrequency" data-enum="relatorioFrequencia" data-selected="weekly"></select>
					</div>
					<div class="col-6 col-md-3">
						<label class="form-label small">Dia/Hora</label>
						<input class="form-control" placeholder="Seg 09:00">
					</div>
				</div>

				<div class="d-flex flex-wrap gap-2 mt-3">
					<button class="btn btn-ghost btn-sm"><i class="bi bi-calendar2-check me-1"></i>Salvar agendamento</button>
					<button class="btn btn-ghost btn-sm"><i class="bi bi-send me-1"></i>Enviar agora (teste)</button>
				</div>
			</div>
		</div>
	</div>

	<div style="height:14px;"></div>
</section>

<!-- Templates -->
<template id="tpl-report-tile">
	<div class="tile">
		<div class="d-flex align-items-start justify-content-between gap-2">
			<div class="d-flex align-items-center gap-2">
				<div class="iconbox"><i class="bi" data-role="tile-icon"></i></div>
				<div>
					<div class="fw-bold" data-role="tile-title"></div>
					<div class="text-muted small" data-role="tile-desc"></div>
				</div>
			</div>
			<span class="pill"><i class="bi bi-tag"></i><span data-role="tile-scope"></span></span>
		</div>
	</div>
</template>

@section Footer {
	@{
		var footerItems = new[]
		{
			new { Icon = "bi-graph-up", Text = "Relat?rios", Id = "", Class = "" },
			new { Icon = "bi-shield-check", Text = "LGPD", Id = "", Class = "" },
			new { Icon = "", Text = "build: demo", Id = "buildId", Class = "mono muted" }
		  };
	}
	@await Html.PartialAsync("_Footer", footerItems)
      }



<!-- Bootstrap JS (CDN) -->
@section Scripts {
	<script>
		window.__seedData = @Html.Raw(Model.SeedJson);
	</script>
	<script src="~/js/views/relatorios.js" asp-append-version="true"></script>
}

