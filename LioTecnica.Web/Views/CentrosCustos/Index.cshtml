@model PageSeedViewModel
@{
	ViewData["Title"] = "Portal RH - Liotecnica - Centros de Custo";
	ViewData["SidebarSubtitle"] = "Centros de Custo";
}

@await Html.PartialAsync("_ModalCentrosCustos")
@await Html.PartialAsync("_Toast")

@section Topbar {
	@await Html.PartialAsync("_TopbarBrand", "Tela: Centro de Custo")

	<div class="searchbox position-relative d-none d-md-block">
		<i class="bi bi-search"></i>
		<input id="globalSearchCostCenter" class="form-control" placeholder="Buscar centro de custo..." />
	</div>

	<div class="d-flex align-items-center gap-2">
		<button class="btn btn-ghost" type="button" id="btnExportCostCenter" title="Exportar centros de custo (CSV)">
			<i class="bi bi-filetype-csv"></i><span class="d-none d-sm-inline ms-1">Exportar</span>
		</button>
		<button class="btn btn-brand" type="button" id="btnNewCostCenter">
			<i class="bi bi-plus-lg"></i><span class="d-none d-sm-inline ms-1">Novo CC</span>
		</button>
		@await Html.PartialAsync("_TopbarUserMenu", "RH")
	</div>
}

<section class="content">
	<div class="page-title">
		<div>
			<h4>Centros de Custo</h4>
			<div class="subtitle">Gerencie centros de custo usados em departamentos, orçamento e alocação de despesas.</div>
		</div>
	</div>

	@{
		// KPIs (valores preenchidos via JS)
		var kpis = new[]
		{
	new { ColClass = "col-6 col-lg-3", Title = "Centros de Custo", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiCcTotal", Value = "0", PillIcon = "bi-cash-stack", PillText = "total", Hint = "Centros de custo cadastrados." },
	new { ColClass = "col-6 col-lg-3", Title = "Ativos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiCcActive", Value = "0", PillIcon = "bi-check2-circle", PillText = "ativo", Hint = "Centros de custo em operação." },
	new { ColClass = "col-6 col-lg-3", Title = "Departamentos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiCcDepartments", Value = "0", PillIcon = "bi-diagram-3", PillText = "vinc.", Hint = "Departamentos vinculados (soma/contagem)." },
	new { ColClass = "col-6 col-lg-3", Title = "Headcount", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiCcHeadcount", Value = "0", PillIcon = "bi-people", PillText = "pessoas", Hint = "Soma do headcount dos departamentos vinculados." }
	};
	}
	@await Html.PartialAsync("_KpiMiniRow", kpis)

	<div class="card-soft p-3 mb-3">
		<div class="d-flex flex-wrap align-items-end justify-content-between gap-2">
			<div>
				<div class="fw-bold">Lista de centros de custo</div>
				<div class="text-muted small">Clique em um CC para ver detalhes e vínculos com departamentos.</div>
			</div>

			<div class="d-flex flex-wrap gap-2 justify-content-end">
				<div style="min-width:240px;">
					<label class="form-label small mb-1">Buscar</label>
					<div class="input-group">
						<span class="input-group-text" style="background:rgba(255,255,255,.65)">
							<i class="bi bi-search"></i>
						</span>
						<input class="form-control" id="ccSearch" placeholder="nome, código...">
					</div>
				</div>

				<div>
					<label class="form-label small mb-1">Status</label>
					<!-- ? ID corrigido para o que o JS usa: #ccStatusFilter -->
					<select class="form-select" id="ccStatusFilter">
						<option value="all">Todos</option>
						<option value="ativo">Ativo</option>
						<option value="inativo">Inativo</option>
					</select>
				</div>

				<div>
					<label class="form-label small mb-1">Vínculo</label>
					<select class="form-select" id="ccLink">
						<option value="all">Todos</option>
						<option value="linked">Com departamentos</option>
						<option value="unlinked">Sem departamentos</option>
					</select>
				</div>
			</div>
		</div>

		<hr class="my-3 divider">

		<lt-grid table-class="table table-sm align-middle mb-0" body-id="ccTbody">
			<lt-grid-header>
				<tr>
					<th>Centro de Custo</th>
					<th>Descricao</th>
					<th class="text-nowrap">Departamentos</th>
					<th class="text-nowrap">Headcount</th>
					<th>Status</th>
					<th class="text-end">Acoes</th>
				</tr>
			</lt-grid-header>
		</lt-grid>

		<div class="d-flex align-items-center justify-content-between mt-2">
			<div class="text-muted small" id="ccHint">-</div>
			<div class="d-flex align-items-center gap-2">
				<span class="pill"><i class="bi bi-table"></i><span id="ccCount">0</span> exibidos</span>
			</div>
		</div>
	</div>

	<!-- Templates -->
	<template id="tpl-cc-row">
		<tr>
			<td>
				<div class="fw-semibold" data-role="cc-name"></div>
				<div class="text-muted small" data-role="cc-code"></div>
			</td>

			<td data-role="cc-desc"></td>

			<td class="mono" data-role="cc-depts"></td>

			<td class="mono" data-role="cc-headcount"></td>

			<td><span data-role="cc-status-host"></span></td>
			<td class="text-end">
				<button class="btn btn-ghost btn-sm me-1" type="button" data-act="detail" title="Detalhes">
					<i class="bi bi-eye"></i>
				</button>
				<button class="btn btn-ghost btn-sm me-1" type="button" data-act="edit" title="Editar">
					<i class="bi bi-pencil"></i>
				</button>
				<button class="btn btn-ghost btn-sm text-danger" type="button" data-act="del" title="Excluir">
					<i class="bi bi-trash3"></i>
				</button>
			</td>
		</tr>
	</template>

	<template id="tpl-cc-empty-row">
		<tr>
			<td colspan="6" class="text-center text-muted py-3">Nenhum centro de custo encontrado.</td>
		</tr>
	</template>

	<div style="height:14px;"></div>
</section>

@section Footer {
	@{
		var footerItems = new[]
		{
	  new { Icon = "bi-cash-stack", Text = "Centro de Custo", Id = "", Class = "" },
	  new { Icon = "bi-shield-check", Text = "LGPD", Id = "", Class = "" },
	  new { Icon = "", Text = "build: demo", Id = "buildId", Class = "mono muted" }
	};
	}
	@await Html.PartialAsync("_Footer", footerItems)
}

@section Scripts {
    <script type="application/json" id="seedData">
        @Html.Raw(Model.SeedJson)
    </script>
    <script>
        const seedElement = document.getElementById("seedData");
        window.__seedData = seedElement ? JSON.parse(seedElement.textContent || "null") : null;
    </script>
	<script src="~/js/views/centros-custos.js" asp-append-version="true"></script>
}
